# 分布式基础理论

## 参考资料

1. 微服务架构设计:https://gudaoxuri.gitbook.io/microservices-architecture/
2. 

## 定义

“分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像是单个相关系统”。

## RPC

> Remote Procedure Call

远程过程调用，是一种进程间通信方式，它是一种技术的思想，而不是规范。它允许程序调用另一个地址空间（通常是共享网络的另一台机器上）的过程或函数，而不用程序员显式编码这个远程调用的细节。即程序员无论是调用本地的还是远程的函数，本质上编写的调用代码基本相同。

![RPC 基本原理和实现方式 3](https://img-blog.csdnimg.cn/20190902200812166.png)

![在这里插入图片描述](https://img-blog.csdn.net/20180714111938433?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyMzExOTg5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

## CAP理论

### 定义

CAP作为分布式系统的基础理论，它描述的是一个分布式系统在以下三个特性中：

- 一致性（Consistency）
- 可用性（Availability）
- 分区容错性（Partition Tolerance）

最多满足其中的两个特性。也就是下图所描述的。分布式系统要么满足CA，要么满足CP，要么满足AP。无法同时满足CAP

![img](https://img2018.cnblogs.com/blog/941183/201906/941183-20190614191945691-976367436.png)

### 分区容错性

​		指的是**分布式系统中的某个节点或着网络分区出现了故障的时候，整个系统仍然能对外提供满足一致性和可用性的服务**。也就是说部分故障不会影响整体的使用。事实上，我们在设计分布式系统时都会考虑到bug、硬件、网络等各种原因造成的故障，所以，即使部分节点或着网络出现故障，我们也要求整个系统还是要继续使用的。

### 可用性

​		一直可以正常的做读写操作。简单而言，就是客户端一直可以正常访问并能得到系统的正常响应。用户角度来看就是不会出现系统操作失败或着访问超时等问题。

### 一致性

​		在分布式系统完成某些写操作后任何读操作都应该获取到该写操作的那个最新的值。相当于要求分布式系统中的各个节点时时刻刻保持数据的一致性。

### CAP理论理解

​		如果我们事先保证了分区容错性，也意味着若某个节点故障了，用户还是可以继续访问。这时用户在访问过程中就会出现一致性和可用性不能同时满足的情况，参考下图：

![img](https://img2018.cnblogs.com/blog/941183/201906/941183-20190614193117074-1830209672.png)

![img](https://img2018.cnblogs.com/blog/941183/201906/941183-20190614193138084-1712716947.png)

​		如图假设分布式系统有G1、G2两个节点，初始值都是V0。现有一个client向系统写入了值V1，这里假设直接写的是节点G1。写完之后client再去读取这个值，这时读到了G2节点。由于G2节点与G1节点失去连接，这时G1节点上的数据还未同步到G2节点，因此，客户端读取到的是修改之前的值V0。这就出现了不满足一致性的情况了。相当于满足了可用性，失去了一致性。

​		类似的，如果系统保证了强一致性，那么在client写完G1节点后，G1需要向G2节点同步数据，此时G2节点无法使用，这时如果client再去读取G2节点的数据时，client就会一直处于等待状态，因为系统内各个节点数据未同步上，需要等同步上才能使用。这就相当于满足了一致性，而失去了可用性，过程如下图所示。

![img](https://img2018.cnblogs.com/blog/941183/201906/941183-20190614210523552-1963221130.png)

考虑到多个客户端访问时，一致性和可用性还可以这么理解：假如client1向G1修改某个值的时候，写操作还未完成，client2就发起对该值的读操作，读的是G2节点，这时如果要满足一致性，那么就得让client2暂时无法使用，如果要让client2使用，那么获取到的数据就是不是最新的，系统就不满足一致性。

### CAP取舍

1. CA：优先保证一致性和可用性，放弃分区容错。这也意味着放弃系统的扩展性，系统不再是分布式的，有违设计的初衷；
2. CP：优先保证一致性和分区容错性，放弃可用性。在数据一致性要求比较高的场合（譬如：ZooKeeper、Hbase）是比较常见的做法，一旦发生网络故障或着消息丢失，就会牺牲用户体验，等恢复之后用户才逐渐能访问。
3. AP：优先保证可用性和分区可用性，放弃一致性。NoSQL中的Cassandra就是这种架构。跟CP一样，放弃一致性不是说一致性就不保证了，而是逐渐的变得一致。

# Dubbo基础知识

> 开发文档：https://dubbo.apache.org/zh/docs/v2.7/user/references/

1. 高性能Java RPC框架

   ![img](https://images2018.cnblogs.com/blog/137084/201805/137084-20180507144228272-1688347553.png)

![img](https://pic2.zhimg.com/80/v2-5bf83024871a749d095365d720a0c6ad_1440w.jpg)

# 环境搭建

## ZooKeeper安装(注册中心)

### 教程

1. https://www.cnblogs.com/expiator/p/9853378.html

2. 下载http://mirror.bit.edu.cn/apache/zookeeper/stable/apache-zookeeper-3.6.3-bin.tar.gz（下载带bin的安装包）

## Dubbo-OPS监控中心

